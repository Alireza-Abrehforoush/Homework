\documentclass{article}

\usepackage{graphicx}
\usepackage{rotating}
\usepackage{amsmath}
\usepackage{fancyhdr}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{textcomp}
\usepackage{float}
\usepackage[sorting=none]{biblatex}
\usepackage[margin=1in]{geometry}
\usepackage[font={small,it}]{caption}
\usepackage{placeins}
\usepackage{xepersian}

%\DeclareMathOperator*{\btie}{\bowtie}
\addbibresource{bibliography.bib}
\settextfont[Scale=1.2]{B-NAZANIN.TTF}
\setlatintextfont[Scale=1]{Times New Roman}
\renewcommand{\baselinestretch}{1.5}
\pagestyle{fancy}
\fancyhf{}
\rhead{تکلیف پنجم درس پایگاه داده‌ها 1}
\lhead{\thepage}
\rfoot{علیرضا ابره فروش}
\lfoot{9816603}
\renewcommand{\headrulewidth}{1pt}
\renewcommand{\footrulewidth}{1pt}
%%%%%%%%%%
\lstset
{
    language=[latex]tex,
    basicstyle=\ttfamily,
    commentstyle=\color{black},
    columns=fullflexible,
    keepspaces=true,
    upquote=true,
    showstringspaces=false,
    morestring=[s]\\\%,
    stringstyle=\color{black},
}
%%%%%%%%%%

\begin{document}
\input{titlepage}

%\tableofcontents
\newpage


\section{}%1
مراحل ده‌گانه‌ی طراحی پایگاه داده به شرح زیر است.
\begin{enumerate}
    \item \textbf{\lr{Identify Entities}:}
نقش‌ها، رویدادها، مکان‌ها، اشیاءِ ملموس، یا مفاهیمی که نهایتا کاربر درباره‌ی آن‌ها داده نگه‌داری می‌کند را مشخص کنید.
    \item \textbf{\lr{Find Relationships}:}
وابستگی طبیعی بین هر جفت از \lr{entity}ها را با استفاده از یک ماتریس رابطه پیدا کنید.
	\item \textbf{\lr{Draw Rough ERD}:}
\lr{entity}ها را در مستطیل‌ها و روابط را روی قسمت‌های خطی که \lr{entity}ها را به هم ربط می‌دهند قرار دهید.
	\item \textbf{\lr{Fill in Cardinality}:}
تعداد وقوع یک \lr{entity} را به ازای وقوع یکتای \lr{entity} مربوط به آن تعیین کنید.
	\item \textbf{\lr{Define Primary Keys}:}
\lr{attribute} یا \lr{attribute}هایی که وقوع دقیقا یک رکورد از هر \lr{entity} را مشخص می‌کند را مشخص کنید.
	\item \textbf{\lr{Draw Key-Based ERD}:}
روابطِ \lr{Many-to-Many} را حذف کنید و کلید‌های اصلی و خارجی را در هر \lr{entity} وارد کنید.
	\item \textbf{\lr{Identify Attributes}:}
جزئیات اطلاعاتی(فیلدها) که برای سیستم درحال توسعه الزامی هستند را نام‌گذاری کنید.
	\item \textbf{\lr{Map Attributes}:}
هر \lr{attribute} را با دقیقا یک \lr{entity} که آن را توصیف می‌کند، نظیر کنید.
	\item \textbf{\lr{Draw Fully Attributed ERD}:}
\lr{ERD}ِ گام ششم را با \lr{entity}ها و روابط کشف شده در گام هشتم سازگار کنید.
	\item \textbf{\lr{Check Results}:}
آیا \lr{ERD}ِ نهایی سیستم داده را به دقت مجسم می‌کند؟
\end{enumerate}

\section{}%2
\subsection{\lr{Composite Attribute}}
برای پیاده‌سازی فیزیکی این نوع \lr{attribute}ها می‌توان هر عنصرِ آن‌ها را در هر \lr{entity} همانند \lr{attribute}های عادیِ آن \lr{entity} به \lr{entity} اضافه می‌کرد. در طراحی برای متمایز کردنشان می‌توان از \lr{indent} استفاده کرد.
\subsection{\lr{Multivalued Attribute}}
برای پیاده‌سازی فیزیکی این نوع \lr{attribute}ها می‌توان یک \lr{table} متناظر با آن \lr{attribute} ایجاد کرد و کلید خارجی از \lr{entity}ی اولیه برای آن تعریف کرد.

\section{}%3
\begin{latin}
$
F=
\{
	\{M\}\longrightarrow\{Q\},
	\{Q\}\longrightarrow\{N\},
	\{N\}\longrightarrow\{L, M\},
	\{N\}\longrightarrow\{L\},
	\{P\}\longrightarrow\{L\},
	\{P\}\longrightarrow\{N\},
\}
$
\end{latin}
ابتدا وابستگی‌های تابعی را به گونه‌ای که تنها یک \lr{attribute} در سمت راست آن‌ها قرار داشته باشد بازنویسی می‌کنیم.
\begin{latin}
$
\\F=\\
\{\\
	\{M\}\longrightarrow\{Q\},\\
	\{Q\}\longrightarrow\{N\},\\
	\{N\}\longrightarrow\{L\},\\
	\{N\}\longrightarrow\{M\},\\
	\{N\}\longrightarrow\{L\},\\
	\{P\}\longrightarrow\{L\},\\
	\{P\}\longrightarrow\{N\},\\
\}
$
\end{latin}
حال وابستگی‌های بدیهی را حذف می‌کنیم(چون هیچ وابستگی‌ای که سمت راستش در سمت چپش وجود داشته باشد نداریم پس وابستگی بدیهی وجود ندارد).
\begin{latin}
$
\\F=\\
\{\\
	\{M\}\longrightarrow\{Q\},\\
	\{Q\}\longrightarrow\{N\},\\
	\{N\}\longrightarrow\{L\},\\
	\{N\}\longrightarrow\{M\},\\
	\{N\}\longrightarrow\{L\},\\
	\{P\}\longrightarrow\{L\},\\
	\{P\}\longrightarrow\{N\},\\
\}
$
\end{latin}

سپس سمت چپ هر یک از وابستگی‌ها را کمینه می‌کنیم(کمینه هستند).
\begin{latin}
$
\\F=\\
\{\\
	\{M\}\longrightarrow\{Q\},\\
	\{Q\}\longrightarrow\{N\},\\
	\{N\}\longrightarrow\{L\},\\
	\{N\}\longrightarrow\{M\},\\
	\{N\}\longrightarrow\{L\},\\
	\{P\}\longrightarrow\{L\},\\
	\{P\}\longrightarrow\{N\},\\
\}
$
\end{latin}

در آخر وابستگی‌های تکراری را حذف می‌کنیم.
\begin{latin}
$
\\F=\\
\{\\
	\{M\}\longrightarrow\{Q\},\\
	\{Q\}\longrightarrow\{N\},\\
	\{N\}\longrightarrow\{M\},\\
	\{N\}\longrightarrow\{L\},\\
	\{P\}\longrightarrow\{N\},\\
\}
$
\end{latin}


\section{}%4
ابتدا پوش کانونی را به شکل زیر محاسبه می‌کنیم:
%\newline
\begin{itemize}
    \item [$\bullet$] ابتدا وابستگی تابعی را به یک وابستگی تابعی با یک \lr{attribute} در سمت راست تبدیل می‌کنیم.

\begin{latin}
$
\\F=\\
\{\\
\{A, B\}\longrightarrow\{C\},\\
\{A\}\longrightarrow\{D\},\\
\{A\}\longrightarrow\{E\},\\
\{B\}\longrightarrow\{F\},\\
\{F\}\longrightarrow\{G\},\\
\{F\}\longrightarrow\{H\},\\
\{D\}\longrightarrow\{I\},\\
\{D\}\longrightarrow\{J\}\\
\}
$
\end{latin}
    \item [$\bullet$] حال وابستگی‌های تابعی بدیهی را پاک می‌کنیم.
\begin{latin}
$
\\F=\\
\{\\
\{A, B\}\longrightarrow\{C\},\\
\{A\}\longrightarrow\{D\},\\
\{A\}\longrightarrow\{E\},\\
\{B\}\longrightarrow\{F\},\\
\{F\}\longrightarrow\{G\},\\
\{F\}\longrightarrow\{H\},\\
\{D\}\longrightarrow\{I\},\\
\{D\}\longrightarrow\{J\}\\
\}
$
\end{latin}
    \item [$\bullet$] سپس \lr{attribute}های سمت چپ هر وابستگی تابعی را کمینه می‌کنیم.

\begin{latin}
$
\\F=\\
\{\\
\{A, B\}\longrightarrow\{C\},\\
\{A\}\longrightarrow\{D\},\\
\{A\}\longrightarrow\{E\},\\
\{B\}\longrightarrow\{F\},\\
\{F\}\longrightarrow\{G\},\\
\{F\}\longrightarrow\{H\},\\
\{D\}\longrightarrow\{I\},\\
\{D\}\longrightarrow\{J\}\\
\}
$
\end{latin}
    \item [$\bullet$] در نهایت وابستگی‌های تابعی تکراری(که از سایر وابستگی‌ها نتیجه می‌شوند) را حذف می‌کنیم.

\begin{latin}
$
\\F=\\
\{\\
\{A, B\}\longrightarrow\{C\},\\
\{A\}\longrightarrow\{D\},\\
\{A\}\longrightarrow\{E\},\\
\{B\}\longrightarrow\{F\},\\
\{F\}\longrightarrow\{G\},\\
\{F\}\longrightarrow\{H\},\\
\{D\}\longrightarrow\{I\},\\
\{D\}\longrightarrow\{J\}\\
\}
$
\end{latin}
\end{itemize}
پوش کانونی به دست آمد. حال مجموعه‌ی همه‌ی \lr{attribute}هایی که در سمت راست هیچ وابستگی تابعی قرار ندارند را به دست می‌آوریم. هر کلید کاندید باید شامل این \lr{attribute}ها باشد. این مجموعه برابر است با:
\begin{latin}
$
\{A, B\}
$
\end{latin}
$
\{A, B\}
$
سوپرکلید است، پس تنها کلید کاندید است.
\newline
حال با تجزیه‌ی $R$ به \lr{relation}های 
$R_{1}$، $R_{2}$ و $R_{3}$
و $F$ به
 \lr{FD}های $F_{1}$، $F_{2}$ و $F_{3}$ 
به شکل زیر،
 \lr{partial dependency}ها را حذف می‌کنیم و به فرم نرمال دوم می‌رسیم.

\begin{latin}
$
\\
R_{1}=\{A, D, E, I, J\}\\
F_{1}=\\
\{\\
\{A\}\longrightarrow\{D, E\},\\
\{D\}\longrightarrow\{I, J\},\\
\}
\\
\\
R_{2}=\{B, F, G, H\}\\
F_{2}=\\
\{\\
\{B\}\longrightarrow\{F\},\\
\{F\}\longrightarrow\{G, H\},\\
\}
\\
\\
R_{3}=\{A, B, C\}\\
F_{3}=\\
\{\\
\{A, B\}\longrightarrow\{C\},\\
\}
$
\end{latin}
برای دستیابی به فرم نرمال سوم باید \lr{transitive dependency}ها را حذف کنیم. با توجه به اینکه هیچ \lr{FD}ای وجود ندارد که سمت چپ آن یک \lr{attribute}ِ \lr{nonprime} باشد، فرم نرمال سوم همان فرم به دست آمده در مرحله قبل است.
\begin{latin}
$
\\
R_{1}=\{A, D, E, I, J\}\\
F_{1}=\\
\{\\
\{A\}\longrightarrow\{D, E\},\\
\{D\}\longrightarrow\{I, J\},\\
\}
\\
\\
R_{2}=\{B, F, G, H\}\\
F_{2}=\\
\{\\
\{B\}\longrightarrow\{F\},\\
\{F\}\longrightarrow\{G, H\},\\
\}
\\
\\
R_{3}=\{A, B, C\}\\
F_{3}=\\
\{\\
\{A, B\}\longrightarrow\{C\},\\
\}
$
\end{latin}

\section{}
\subsection{\lr{a}}
%begintable
\begin{table}[H]
\resizebox{\textwidth}{!}{%
\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|c|}
\hline
                           & \textbf{\lr{Branch}} & \textbf{\lr{Manager}} & \textbf{\lr{Provider}} & \textbf{\lr{Staff}} & \textbf{\lr{Time}} & \textbf{\lr{Food}}  & \textbf{\lr{Organization}} & \textbf{\lr{Complaint}} & \textbf{\lr{Customer}}     & \textbf{\lr{Ingredient}} \\
\hline\textbf{\lr{Branch}}       &                      & \lr{Managed by}       & \lr{Supplied by}       & \lr{Employes}       &                    &                     & \lr{Caters}                & \lr{Has}                &                            &                          \\
\hline\textbf{\lr{Manager}}      & \lr{Manages}         & \lr{Superior to}      &                        &                     &                    &                     &                            &                         &                            &                          \\
\hline\textbf{\lr{Provider}}     & \lr{Supplies}        &                       &                        &                     &                    &                     &                            &                         &                            & \lr{Provides}   \\
\hline\textbf{\lr{Staff}}        & \lr{Employed by}     &                       &                        &                     & \lr{Works in}      &                     &                            &                         &                            &                          \\
\hline\textbf{\lr{Time}}         &                      &                       &                        & \lr{Is assigned to} &                    &                     &                            &                         &                            &                          \\
\hline\textbf{\lr{Food}}         &                      &                       &                        &                     &                    &                     &                            &                         & \lr{Ordered by, Graded by} & \lr{Is made of}          \\
\hline\textbf{\lr{Organization}} & \lr{Catered by}      &                       &                        &                     &                    &                     &                            &                         &                            &                          \\
\hline\textbf{\lr{Complaint}}    & \lr{Assigned to}     &                       &                        &                     &                    &                     &                            &                         & \lr{Installed by}          &                          \\
\hline\textbf{\lr{Customer}}     &                      &                       &                        &                     &                    & \lr{Orders, Grades} &                            & \lr{Installs}           &                            &                          \\
\hline\textbf{\lr{Ingredient}}   &                      &                       & \lr{Provided by}       &                     &                    & \lr{Make}           &                            &                         &                            &                         
\end{tabular}%
}
\end{table}
%endtable

\subsection{\lr{b}}
\begin{itemize}
    \item [$\bullet$] نام شعبه در در سفارشات و غذاها مشخص نمی‌شود.
    \item [$\bullet$] هر تامین‌کننده می‌تواند با صفر تا چند شعبه کار کند.
    \item [$\bullet$] هر سازمان دقیقا با یک شعبه قرارداد دارد.
    \item [$\bullet$] به هر مشتری صرف نظر از اینکه مشترک هست یا موردی یک شناسه اختصاص می‌دهیم.
    \item [$\bullet$] اینکه شکایت مربوط به چه سرویسی یا چه غذایی است لحاظ نمی‌شود.
    \item [$\bullet$] هر مشتری تنها پس از صرف غذا نمره می‌دهد و نمره‌دهی بدون صرف غذا نداریم.
\end{itemize}
\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{figures/D1.jpg}
    \caption
	{
\lr{4-a}
	}
    \label{fig:fig1}
\end{figure}

\subsection{\lr{b}}
\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{figures/D2.jpg}
    \caption
	{
\lr{4-b}
	}
    \label{fig:fig1}
\end{figure}

\section{}
\begin{itemize}
    \item [$\bullet$] هر \lr{Reservation} متعلق به دقیقا یک مشتری است.
    \item [$\bullet$] کاردینالیتی‌های بیشتر از 1 به \lr{Many} نظیر شده اند.
\end{itemize}

%beigintable
\begin{table}[H]
\resizebox{\textwidth}{!}
{
\begin{tabular}{|c|c|c|c|c|c|c|c|c|}
\hline                          & \textbf{\lr{Customer}} & \textbf{\lr{Reservation}} & \textbf{\lr{Flight}} & \textbf{\lr{Stewardess}} & \textbf{\lr{Pilot}} & \textbf{\lr{Airport}} & \textbf{\lr{City}} \\
\hline\textbf{\lr{Customer}}    &                        & \lr{Reserves}             &                      &                          &                     &                       &                    \\
\hline\textbf{\lr{Reservation}} & \lr{Reserved by}       &                           & \lr{Services}        &                          &                     &                       &                    \\
\hline\textbf{\lr{Flight}}      &                        & \lr{Is the service of}    &                      & \lr{Has}                 & \lr{Has}            & \lr{From, To}         & \lr{From, To}      \\
\hline\textbf{\lr{Stewardess}}  &                        &                           & \lr{Attends at}      &                          &                     & \lr{Works at}         &                    \\
\hline\textbf{\lr{Pilot}}       &                        &                           & \lr{Attends at}      &                          &                     & \lr{Works at}         &                    \\
\hline\textbf{\lr{Airport}}     &                        &                           &                      & \lr{Works with}          & \lr{Works with}     &                       & \lr{Is located in} \\
\hline\textbf{\lr{City}}        &                        &                           &                      &                          &                     & \lr{Has}              &                   
\end{tabular}%
}
\end{table}
%endtable
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{figures/D3.jpg}
    \caption
	{
\lr{6-a}
	}
    \label{fig:fig1}
\end{figure}
\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{figures/D4.jpg}
    \caption
	{
\lr{6-b}
	}
    \label{fig:fig1}
\end{figure}
\begin{itemize}
    \item [$\bullet$] درصورت عدم وضوح کافی تصاویر، فایلِ \lr{Visio}ی دیاگرام‌ها در فایل زیپ موجود است.
\end{itemize}

\section{}
\subsection{\lr{a}}
داخل فایل \lr{SQL}
\subsection{\lr{b}}
داخل فایل \lr{SQL}
%------------------------------------------------------------------------------------------


\section*{منابع}
\renewcommand{\section}[2]{}%
\begin{thebibliography}{99} % assumes less than 100 references
%چنانچه مرجع فارسی نیز داشته باشید باید دستور فوق را فعال کنید و مراجع فارسی خود را بعد از این دستور وارد کنید


\begin{LTRitems}

\resetlatinfont

\bibitem{b1} None
\end{LTRitems}

\end{thebibliography}


\end{document}
